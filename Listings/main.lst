C51 COMPILER V9.52.0.0   MAIN                                                              03/14/2019 17:26:15 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\main.c LARGE OPTIMIZE(2,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "debug.h"
   2          #include "commands_parser.h"
   3          #include "serializer.h"
   4          
   5          sfr Reg = 0xFF;
   6          
   7          void Init_External_clk()
   8          {
   9   1        // Config External Osci
  10   1        OSCXCN = 0x67;
  11   1        while(OSCXCN != 0xE7) {}
  12   1        
  13   1        // Use Exern CLK
  14   1        OSCICN = 0x08;
  15   1      }
  16          
  17          void Init_Crossbar()
  18          {
  19   1        // Init UART0 on Crossbar
  20   1        XBR0 = 0x04;
  21   1        
  22   1        // Init UART1 on Crossbar
  23   1        XBR2 |= 0x04;
  24   1        
  25   1        // Push Pull mode
  26   1        P0MDOUT = 0xFF;
  27   1        
  28   1        // Enable Crossbar
  29   1        XBR2 |= 0x40;
  30   1      }
  31          
  32          
  33          #ifdef ROBOT
  34          
  35          int main (void)
  36          {
  37   1        /*
  38   1        OUT_M1 commands = {Epreuve_non, // Numéro Epreuve
  39   1                            Mouvement_non,  // Etat mouvement
  40   1                            0,  //  Vitesse
  41   1                            0,  // Coord_X
  42   1                            0,  // Coord_Y
  43   1                            0,  // Angle
  44   1                            ACQ_non,  // Commande d'acquisition du son
  45   1                            0,  // Durée d'acquisition
  46   1                            DCT_non,  // Commande de détection d'obstacle
  47   1                            0,  // Résolution angulaire de la détection d'obstacle
  48   1                            Lumiere_non,  // Commande d'allumage du pointeur lumineux
  49   1                            0,  //Intensitée lumineuse
  50   1                            0,  // Durée d'allumage
  51   1                            0,  // Durée d'extinction
  52   1                            0,  // Nombre de cycles d'allumage
  53   1                            Servo_non,  // Commande de position du servo
  54   1                            0,  // Paramètre angle
C51 COMPILER V9.52.0.0   MAIN                                                              03/14/2019 17:26:15 PAGE 2   

  55   1                            Energie_non,  // Commande relevée courant
  56   1                            Position_non, // Commande de gestion de position
  57   1                            0,  // Coord X de position
  58   1                            0,  // Coord Y de position
  59   1                            0,  // Angle
  60   1                            Photo_non,  // Commande de prise de phot
  61   1                            0,  // Temps entre deux photo
  62   1                            0 // Nbr de photo
  63   1                            };*/
  64   1      
  65   1        PARSER_RESULT parser_result = {
  66   1          
  67   1      
  68   1                            1 ,
  69   1          
  70   1                            {Epreuve_non, // Numéro Epreuve
  71   1                            Mouvement_non,  // Etat mouvement
  72   1                            0,  //  Vitesse
  73   1                            0,  // Coord_X
  74   1                            0,  // Coord_Y
  75   1                            0,  // Angle
  76   1                            ACQ_non,  // Commande d'acquisition du son
  77   1                            0,  // Durée d'acquisition
  78   1                            DCT_non,  // Commande de détection d'obstacle
  79   1                            0,  // Résolution angulaire de la détection d'obstacle
  80   1                            Lumiere_non,  // Commande d'allumage du pointeur lumineux
  81   1                            0,  //Intensitée lumineuse
  82   1                            0,  // Durée d'allumage
  83   1                            0,  // Durée d'extinction
  84   1                            0,  // Nombre de cycles d'allumage
  85   1                            Servo_non,  // Commande de position du servo
  86   1                            0,  // Paramètre angle
  87   1                            Energie_non,  // Commande relevée courant
  88   1                            Position_non, // Commande de gestion de position
  89   1                            0,  // Coord X de position
  90   1                            0,  // Coord Y de position
  91   1                            0,  // Angle
  92   1                            Photo_non,  // Commande de prise de phot
  93   1                            0,  // Temps entre deux photo
  94   1                            0 // Nbr de photo
  95   1                            }
  96   1      
  97   1                    };
  98   1        
  99   1        
 100   1        Reg = 0xDE;   // Dévalidation du watchdog 
 101   1        Reg = 0xAD;
 102   1        
 103   1        // µP candencé sur clk extern à 22 MHz           
 104   1        Init_External_clk();
 105   1        
 106   1        // Initialise l'UART0 et le Timer 2 pour le parser de commandes       
 107   1        init_parser();
 108   1          
 109   1        // Initialise l'UART1 utilisé pour communiquer avec le sérializer
 110   1        init_serializer_UART1();
 111   1                    
 112   1        Init_Crossbar();
 113   1      
 114   1        USART_print("Start Routine \n\n");
 115   1                    
 116   1        serializer_init_serial();
C51 COMPILER V9.52.0.0   MAIN                                                              03/14/2019 17:26:15 PAGE 3   

 117   1                    
 118   1        USART_print("#############################\n\n");
 119   1      
 120   1        //serializer_print("mogo 1:50 2:50");
 121   1                  
 122   1        while(1)
 123   1        {
 124   2          
 125   2          //parser_process(state, &parser_result);
 126   2          cmd_parser_process(&parser_result);
 127   2          
 128   2          if( parser_result.commands.Etat_Epreuve == Stop_Urgence)
 129   2          {
 130   3            USART_print("Quit");
 131   3            break;
 132   3          }
 133   2          serializer_process(&(parser_result.commands));
 134   2          //serializer_send('H');
 135   2          //USART_send('A');
 136   2          //printf("Commande lu : %u", (int)(parser_result.commands->Etat_Epreuve));
 137   2        
 138   2          
 139   2          //serializer_print("mogo 1:50 2:50\r");
 140   2          
 141   2        }
 142   1        
 143   1        USART_print("Fin Soft");
 144   1        
 145   1        while(1);
 146   1      }
 147          
 148          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    153    ----
   CONSTANT SIZE    =     91    ----
   XDATA SIZE       =   ----      28
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
